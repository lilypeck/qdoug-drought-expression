summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = "Indiv", values_from = "Expression") %>%
dplyr::select(contains("Drought")) %>%
pivot_longer(cols = c(-GO.enrich, -DEG, -term), names_to = "Indiv", values_to = "vals") %>%
separate_wider_delim(cols = Indiv, names = c("q","fam","treatment","time"), delim = "_") %>%
unite(q:fam, col = Indiv, sep = "_") %>%
group_by(DEG,GO.enrich, term,time) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = time, values_from = Expression) %>%
mutate(diff = abs((T2-T1)/T1)) %>%
#filter(diff > abs(0.87)) %>%
pivot_longer(cols = T1:T2, names_to = "time", values_to = "Expression") %>%
mutate(term = gsub("oxidoreductase activity.*$","oxidoreductase activity",term))
## plot
drought.deseq.go.hm %>%
filter(DEG == "T2.Down") %>%
drop_na()
142/2
## tidy differential expression data for plotting
drought.deseq.go.hm <- drought.deseq %>%
left_join(enrich2) %>%
relocate(GO.enrich, .before = "sampleA") %>%
mutate(DEG = case_when(log2FoldChange < 0 ~ "T2.Down",
log2FoldChange > 0 ~ "T2.Up")) %>%
dplyr::select(!sampleA:padj) %>%
pivot_longer(cols = `QUDO_10_Control_T1_1`:`QUDO_9_Drought_T2_8`, names_to = "nams", values_to = "vals") %>%
dplyr::select(!edger:ww) %>%
separate_wider_delim(cols = nams, names = c("q","fam","treatment","time","indiv"), delim = "_") %>%
unite(q:time, col = "Indiv", sep = "_") %>%
group_by(DEG,GO.enrich,term,Indiv) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = "Indiv", values_from = "Expression") %>%
dplyr::select(contains("Drought")) %>%
pivot_longer(cols = c(-GO.enrich, -DEG, -term), names_to = "Indiv", values_to = "vals") %>%
separate_wider_delim(cols = Indiv, names = c("q","fam","treatment","time"), delim = "_") %>%
unite(q:fam, col = Indiv, sep = "_") %>%
group_by(DEG,GO.enrich, term,time) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = time, values_from = Expression) %>%
mutate(diff = abs((T2-T1)/T1)) %>%
#filter(diff > abs(0.87)) %>%
pivot_longer(cols = T1:T2, names_to = "time", values_to = "Expression") %>%
mutate(term = gsub("oxidoreductase activity.*$","oxidoreductase activity",term))
drought.deseq.go.hm <- drought.deseq %>%
left_join(enrich2) %>%
relocate(GO.enrich, .before = "sampleA") %>%
mutate(DEG = case_when(log2FoldChange < 0 ~ "T2.Down",
log2FoldChange > 0 ~ "T2.Up")) %>%
dplyr::select(!sampleA:padj) %>%
pivot_longer(cols = `QUDO_10_Control_T1_1`:`QUDO_9_Drought_T2_8`, names_to = "nams", values_to = "vals") %>%
dplyr::select(!edger:ww) %>%
separate_wider_delim(cols = nams, names = c("q","fam","treatment","time","indiv"), delim = "_") %>%
unite(q:time, col = "Indiv", sep = "_") %>%
group_by(DEG,GO.enrich,term,Indiv) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = "Indiv", values_from = "Expression") %>%
dplyr::select(contains("Drought")) %>%
pivot_longer(cols = c(-GO.enrich, -DEG, -term), names_to = "Indiv", values_to = "vals") %>%
separate_wider_delim(cols = Indiv, names = c("q","fam","treatment","time"), delim = "_") %>%
unite(q:fam, col = Indiv, sep = "_") %>%
group_by(DEG,GO.enrich, term,time) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = time, values_from = Expression) %>%
mutate(diff = abs((T2-T1)/T1))
View(drought.deseq.go.hm)
drought.deseq.go.hm <- drought.deseq %>%
left_join(enrich2) %>%
relocate(GO.enrich, .before = "sampleA") %>%
mutate(DEG = case_when(log2FoldChange < 0 ~ "T2.Down",
log2FoldChange > 0 ~ "T2.Up")) %>%
dplyr::select(!sampleA:padj) %>%
pivot_longer(cols = `QUDO_10_Control_T1_1`:`QUDO_9_Drought_T2_8`, names_to = "nams", values_to = "vals") %>%
dplyr::select(!edger:ww) %>%
separate_wider_delim(cols = nams, names = c("q","fam","treatment","time","indiv"), delim = "_") %>%
unite(q:time, col = "Indiv", sep = "_") %>%
group_by(DEG,GO.enrich,term,Indiv) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = "Indiv", values_from = "Expression") %>%
dplyr::select(contains("Drought")) %>%
pivot_longer(cols = c(-GO.enrich, -DEG, -term), names_to = "Indiv", values_to = "vals") %>%
separate_wider_delim(cols = Indiv, names = c("q","fam","treatment","time"), delim = "_") %>%
unite(q:fam, col = Indiv, sep = "_") %>%
group_by(DEG,GO.enrich, term,time) %>%
summarise(Expression = mean(vals)) %>%
pivot_wider(names_from = time, values_from = Expression) %>%
mutate(diff = abs((T2-T1)/T1)) %>%
filter(diff > abs(0.87))
## format expression files for each site
qlob.macr <- qlob.macr %>% mutate(Site = "MACR")
qlob.cent <- qlob.cent %>% mutate(Site = "CENT")
qlob.both <- bind_rows(qlob.macr,qlob.cent)
# tidy pfams
qlob.pfam2 <- qlob.pfam %>%
filter(X4 == "Pfam") %>%
dplyr::select(X1,X5,X6) %>%
distinct() %>%
rename(gene = X1, Pfam = X5, Pfam.name = X6)
## get mean expression for all genes that are DEG in both sites
qlob.both2 <- qlob.both %>%
dplyr::select(!sampleA:padj) %>%
pivot_longer(cols = -c(gene, Site), names_to = "nams", values_to = "vals") %>%
separate_wider_delim(nams, names = c("Treatment","Pop","Mum","Indiv"), delim = "_") %>%
filter(!Pop == "REDI") %>%
group_by(gene,Pop,Mum,Treatment) %>%
summarise(mean = mean(vals)) %>%
group_by(gene,Pop,Treatment) %>%
summarise(expr = mean(mean))
## get list of drought-responsive pfams with >1 DEG
qlob.both.deg.n <- qlob.both2 %>%
ungroup() %>%
dplyr::select(gene) %>%
distinct() %>%
left_join(qlob.pfam2) %>%
mutate(temp = Pfam %in% pfam.n$pfam) %>%
filter(temp == T) %>%
group_by(Pfam) %>%
summarise(n = n()) %>%
filter(n > 1)
## new fig 6 - standard error curves
## format expression files for each site
qlob.macr <- qlob.macr %>% mutate(Site = "MACR")
qlob.cent <- qlob.cent %>% mutate(Site = "CENT")
qlob.both <- bind_rows(qlob.macr,qlob.cent)
# tidy pfam list
qlob.pfam2 <- qlob.pfam %>%
filter(X4 == "Pfam") %>%
dplyr::select(X1,X5,X6) %>%
distinct() %>%
rename(gene = X1, Pfam = X5, Pfam.name = X6)
## get mean expression for all Qlob genes that are DEG across both sites
qlob.both2 <- qlob.both %>%
dplyr::select(!sampleA:padj) %>%
pivot_longer(cols = -c(gene, Site), names_to = "nams", values_to = "vals") %>%
separate_wider_delim(nams, names = c("Treatment","Pop","Mum","Indiv"), delim = "_") %>%
filter(!Pop == "REDI") %>%
mutate(Keep = case_when(Site == "MACR" & Pop == "MACR" ~ "Yes",
Site == "CENT" & Pop == "CENT" ~ "Yes")) %>%
filter(Keep == "Yes") %>%
group_by(gene,Pop,Mum,Treatment) %>%
summarise(mean = mean(vals)) %>%
group_by(gene,Pop,Treatment) %>%
summarise(expr = mean(mean))
## get list of drought-responsive pfams with >1 DEG, this is 20 Pfams
qlob.both.deg.n <- qlob.both2 %>%
ungroup() %>%
dplyr::select(gene) %>%
distinct() %>%
left_join(qlob.pfam2) %>%
mutate(temp = Pfam %in% pfam.n$pfam) %>%
filter(temp == T) %>%
group_by(Pfam) %>%
summarise(n = n()) %>%
filter(n > 1)
## tidy and identify pfams DE in both studies
## select all pfams, not just first in list
gugger.de2 <- gugger.de %>%
dplyr::select(Contig, `TAIR or Pfam ID`) %>%
rename(Pfam.gugger = `TAIR or Pfam ID`) %>%
drop_na() %>%
filter(!grepl("AT",Pfam.gugger)) %>%
separate_wider_delim(Pfam.gugger, names_sep = "", delim = " ", too_few = "debug") %>%
dplyr::select(Contig:Pfam.gugger15) %>%
pivot_longer(cols = -c(Contig), names_to = "nams", values_to = "vals") %>%
drop_na() %>%
mutate(Pfam.gugger = gsub(".*:","",vals)) %>%
dplyr::select(Contig, Pfam.gugger)
## filtered by pval < 0.01 to make more stringent
mead.de2 <- mead.de %>%
filter(adj.P.Val < 0.01) %>%
separate_wider_delim(cols = pfam_id, delim = ", ", names_sep = "",too_few = "debug") %>%
dplyr::select(gene,pfam_id1:pfam_id5) %>%
pivot_longer(cols = -c(gene), names_to = "nams", values_to = "vals") %>%
dplyr::select(!nams) %>%
filter(!vals == "none") %>%
drop_na() %>%
mutate(vals = gsub(".*:","",vals),
vals = gsub("\\..*$","",vals)) %>%
rename(pfam = vals) %>%
mutate(both = pfam %in% gugger.de2$Pfam.gugger) %>%
filter(both == T)
# get Q. lobata pfam names as list
pfam.n <- mead.de2 %>%
dplyr::select(pfam) %>%
distinct()
pfam.n
## now check expression of these same pfams in Q. douglasii
annots2 <- annots %>%
separate_wider_delim(cols = Pfam, delim = "`", names_sep = "",too_few = "debug") %>%
dplyr::select(transcript_id,Pfam1:Pfam10) %>%
pivot_longer(cols = Pfam1:Pfam10, names_to = "nams",values_to = "vals") %>%
drop_na() %>%
filter(!vals == ".") %>%
mutate(vals = gsub("\\^.*$","",vals),
vals = gsub("\\..*$","",vals),
temp = vals %in% pfam.n$pfam) %>%
rename(pfam = vals, gene = transcript_id)
annots2
## get pfams which were DEG in both mead and gugger
annots.deg <- annots2 %>%
filter(temp == TRUE) %>%
dplyr::select(gene,pfam)
## tidy GO enrichment file
enrich2 <- enrich %>%
filter(over_represented_pvalue < 0.01) %>%
unite(term:ontology, col = "term", sep = " ") %>%
dplyr::select(category,term,gene_ids) %>%
separate_wider_delim(gene_ids, delim = ", ", names_sep = "", too_few = "debug") %>%
dplyr::select(category,term,gene_ids1:gene_ids14) %>%
pivot_longer(cols = gene_ids1:gene_ids14, names_to = "nams", values_to = "gene") %>%
drop_na() %>%
dplyr::select(!nams) %>%
rename(GO.enrich = category)
# drought treatment
dr.genes2 <- all.genes %>%
left_join(annots.deg) %>%
mutate(temp = pfam %in% pfam.n$pfam) %>%
filter(temp == T) %>%
pivot_longer(cols = baseMeanA:baseMeanB, names_to = "nams", values_to = "vals") %>%
# group_by(pfam,gene,nams) %>%
# summarise(Expression = mean(vals),gene.n = n()) %>%
rename(Treatment = nams) %>%
mutate(Treatment = gsub("baseMeanA","Drought_Time 2",Treatment),
Treatment = gsub("baseMeanB","Drought_Time 1",Treatment)) %>%
mutate(Pop = "ONEA",
Species= "Qdoug")
# calculate % change
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:DEG) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
pivot_wider(names_from = "Time", values_from = "vals") %>%
mutate(Change = ((`Time 2` - (`Time 1`+1))/(`Time 1`+1))*100) %>%
#dplyr::select(gene:pfam,Treatment,Change) %>%
relocate(pfam, .before = gene)
dr.genes2
## drought t2 vs t1 all genes
all.genes <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Drought_T2_vs_QUDO_Drought_T1.DESeq2.DE_results")
setwd("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Files")
## pull in DE files
gugger.de <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/Gugger-TableS2.csv")
mead.de <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Files/Mead-DE_genes_significant_all_tests.csv")
# Q. douglasii gene annotations
annots <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Files/Qdoug_transcriptome_annotations.tsv")
## drought t2 vs t1 all genes
all.genes <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Drought_T2_vs_QUDO_Drought_T1.DESeq2.DE_results")
# raw expression data from well-watered treatment
ww.genes <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Data/salmon.isoform.counts.matrix.QUDO_Control_T2_vs_QUDO_Control_T1.DESeq2.DE_results")
# drought treatment
dr.genes2 <- all.genes %>%
left_join(annots.deg) %>%
mutate(temp = pfam %in% pfam.n$pfam) %>%
filter(temp == T) %>%
pivot_longer(cols = baseMeanA:baseMeanB, names_to = "nams", values_to = "vals") %>%
# group_by(pfam,gene,nams) %>%
# summarise(Expression = mean(vals),gene.n = n()) %>%
rename(Treatment = nams) %>%
mutate(Treatment = gsub("baseMeanA","Drought_Time 2",Treatment),
Treatment = gsub("baseMeanB","Drought_Time 1",Treatment)) %>%
mutate(Pop = "ONEA",
Species= "Qdoug")
dr.genes2
dr.genes2
annots.deg
# calculate % change
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
pivot_wider(names_from = "Time", values_from = "vals") %>%
mutate(Change = ((`Time 2` - (`Time 1`+1))/(`Time 1`+1))*100) %>%
#dplyr::select(gene:pfam,Treatment,Change) %>%
relocate(pfam, .before = gene)
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_")
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_")
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
pivot_wider(names_from = "Time", values_from = "vals")
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
pivot_wider(names_from = "Time", values_from = "vals")
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_")
View(pcent)
dr.genes2 %>%
dplyr::select(!sampleA:temp)
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
pivot_wider(names_from = "Time", values_from = "vals")
dr.genes2
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
pivot_wider(names_from = "Time", values_from = "vals")
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment", "Time"), delim = "_") %>%
dplyr::summarise(n = dplyr::n(), .by = c(gene, Treatment, Pop, Species, Time)) %>%
dplyr::filter(n > 1L)
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_")
View(pcent)
dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
distinct() %>%
pivot_wider(names_from = "Time", values_from = "vals")
# calculate % change
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
distinct() %>%
pivot_wider(names_from = "Time", values_from = "vals") %>%
mutate(Change = ((`Time 2` - (`Time 1`+1))/(`Time 1`+1))*100) %>%
#dplyr::select(gene:pfam,Treatment,Change) %>%
relocate(pfam, .before = gene)
pcent <- dr.genes2 %>%
dplyr::select(!sampleA:temp) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
distinct() %>%
pivot_wider(names_from = "Time", values_from = "vals") %>%
mutate(Change = ((`Time 2` - (`Time 1`+1))/(`Time 1`+1))*100)
dr.genes2
# calculate % change
pcent <- dr.genes2 %>%
dplyr::select(gene,pfam,Treatment,vals) %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
distinct() %>%
pivot_wider(names_from = "Time", values_from = "vals") %>%
mutate(Change = ((`Time 2` - (`Time 1`+1))/(`Time 1`+1))*100) %>%
#dplyr::select(gene:pfam,Treatment,Change) %>%
relocate(pfam, .before = gene)
pcent
pcent %>%
ggplot(aes(x = gene, y = Change)) +
geom_point(alpha = 0.5) +
facet_wrap(~pfam, scales = "fixed") +
theme(axis.text.x = element_blank())
## tidy and identify pfams DE in both studies
## select all pfams, not just first in list
gugger.de2 <- gugger.de %>%
dplyr::select(Contig, `TAIR or Pfam ID`) %>%
rename(Pfam.gugger = `TAIR or Pfam ID`) %>%
drop_na() %>%
filter(!grepl("AT",Pfam.gugger)) %>%
separate_wider_delim(Pfam.gugger, names_sep = "", delim = " ", too_few = "debug") %>%
dplyr::select(Contig:Pfam.gugger15) %>%
pivot_longer(cols = -c(Contig), names_to = "nams", values_to = "vals") %>%
drop_na() %>%
mutate(Pfam.gugger = gsub(".*:","",vals)) %>%
dplyr::select(Contig, Pfam.gugger)
## filtered by pval < 0.01 to make more stringent
mead.de2 <- mead.de %>%
filter(adj.P.Val < 0.01) %>%
separate_wider_delim(cols = pfam_id, delim = ", ", names_sep = "",too_few = "debug") %>%
dplyr::select(gene,pfam_id1:pfam_id5) %>%
pivot_longer(cols = -c(gene), names_to = "nams", values_to = "vals") %>%
dplyr::select(!nams) %>%
filter(!vals == "none") %>%
drop_na() %>%
mutate(vals = gsub(".*:","",vals),
vals = gsub("\\..*$","",vals)) %>%
rename(pfam = vals) %>%
mutate(both = pfam %in% gugger.de2$Pfam.gugger) %>%
filter(both == T)
# get Q. lobata pfam names as list
pfam.n <- mead.de2 %>%
dplyr::select(pfam) %>%
distinct()
## now check expression of these same pfams in Q. douglasii
annots2 <- annots %>%
separate_wider_delim(cols = Pfam, delim = "`", names_sep = "",too_few = "debug") %>%
dplyr::select(transcript_id,Pfam1:Pfam10) %>%
pivot_longer(cols = Pfam1:Pfam10, names_to = "nams",values_to = "vals") %>%
drop_na() %>%
filter(!vals == ".") %>%
mutate(vals = gsub("\\^.*$","",vals),
vals = gsub("\\..*$","",vals),
temp = vals %in% pfam.n$pfam) %>%
rename(pfam = vals, gene = transcript_id)
## get pfams which were DEG in both mead and gugger
annots.deg <- annots2 %>%
filter(temp == TRUE) %>%
dplyr::select(gene,pfam)
## filter by DEG pfam and tidy data for plotting
# drought treatment
dr.genes2 <- all.genes %>%
left_join(annots.deg) %>%
mutate(temp = pfam %in% pfam.n$pfam) %>%
filter(temp == T) %>%
pivot_longer(cols = baseMeanA:baseMeanB, names_to = "nams", values_to = "vals") %>%
group_by(pfam,nams) %>%
summarise(Expression = mean(vals),gene.n = n()) %>%
rename(Pfam = pfam, Treatment = nams) %>%
mutate(Treatment = gsub("baseMeanA","Drought_Time 2",Treatment),
Treatment = gsub("baseMeanB","Drought_Time 1",Treatment)) %>%
mutate(Pop = "ONEA",
Species= "Qdoug")
# well-watered treatment
ww.genes2 <- ww.genes %>%
left_join(annots.deg) %>%
mutate(temp = pfam %in% pfam.n$pfam) %>%
filter(temp == T) %>%
pivot_longer(cols = baseMeanA:baseMeanB, names_to = "nams", values_to = "vals") %>%
group_by(pfam,nams) %>%
summarise(Expression = mean(vals),gene.n = n()) %>%
rename(Pfam = pfam, Treatment = nams) %>%
mutate(Treatment = gsub("baseMeanA","Well-watered_Time 2",Treatment),
Treatment = gsub("baseMeanB","Well-watered_Time 1",Treatment)) %>%
mutate(Pop = "ONEA",
Species= "Qdoug")
## plot constitutive expression for 81 pfams in qdoug - figure S1
qdoug.both <- bind_rows(dr.genes2,ww.genes2)
pal <- c("#ffad73","#26b3ff")
qdoug.both %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
ggplot(aes(x = Time, y = sqrt(Expression), group = Treatment, color = Treatment)) +
scale_fill_manual(values= pal) +
scale_color_manual(values = pal) +
geom_smooth(aes(color = Treatment, fill = Treatment)) +
#geom_line(size = 1, alpha = 0.5) +
facet_wrap(~factor(Treatment, levels = c("Well-watered","Drought"))) +
theme_minimal() +
coord_cartesian(ylim = c(0,20)) +
theme(axis.title.x = element_blank(),
legend.position = "none") +
ylab("sqrt(Expression)")
?geom_smooth
qdoug.both %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
ggplot(aes(x = Time, y = sqrt(Expression), group = Treatment, color = Treatment)) +
scale_fill_manual(values= pal) +
scale_color_manual(values = pal) +
geom_smooth(aes(color = Treatment, fill = Treatment), se = F) +
#geom_line(size = 1, alpha = 0.5) +
facet_wrap(~factor(Treatment, levels = c("Well-watered","Drought"))) +
theme_minimal() +
coord_cartesian(ylim = c(0,20)) +
theme(axis.title.x = element_blank(),
legend.position = "none") +
ylab("sqrt(Expression)")
qdoug.both %>%
separate_wider_delim(Treatment, names = c("Treatment","Time"),delim = "_") %>%
ggplot(aes(x = Time, y = sqrt(Expression), group = Treatment, color = Treatment)) +
scale_fill_manual(values= pal) +
scale_color_manual(values = pal) +
geom_smooth(aes(color = Treatment, fill = Treatment)) +
#geom_line(size = 1, alpha = 0.5) +
facet_wrap(~factor(Treatment, levels = c("Well-watered","Drought"))) +
theme_minimal() +
coord_cartesian(ylim = c(0,20)) +
theme(axis.title.x = element_blank(),
legend.position = "none") +
ylab("sqrt(Expression)")
## new fig 6 - standard error curves
## format expression files for each site
qlob.macr <- qlob.macr %>% mutate(Site = "MACR")
qlob.cent <- qlob.cent %>% mutate(Site = "CENT")
qlob.both <- bind_rows(qlob.macr,qlob.cent)
# tidy pfam list
qlob.pfam2 <- qlob.pfam %>%
filter(X4 == "Pfam") %>%
dplyr::select(X1,X5,X6) %>%
distinct() %>%
rename(gene = X1, Pfam = X5, Pfam.name = X6)
library(tidyverse)
library(nlme)
library(broom.mixed)
library(multcomp)
library(cowplot)
library(ggpubr)
library(emmeans)
## pull in drought t2 vs t1 DEGs
drought.deseq <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Drought_T2_vs_QUDO_Drought_T1.DESeq2.DE_results.P0.01_C2.DE.subset")
drought.edger <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Drought_T2_vs_QUDO_Drought_T1.edgeR.DE_results.P0.01_C2.DE.subset")
# keep only deseq genes which are DE in edger too
drought.deseq$edger <- drought.deseq$gene %in% drought.edger$gene
drought.deseq <- drought.deseq %>%
filter(edger == T)
## pull in wellwatered t2 vs t1 DEGs
ww.deseq <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Control_T2_vs_QUDO_Control_T1.DESeq2.DE_results.P0.01_C2.DE.subset")
ww.edger <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Control_T2_vs_QUDO_Control_T1.edgeR.DE_results.P0.01_C2.DE.subset")
# keep only deseq genes which are DE in edger too
ww.deseq$edger <- ww.deseq$gene %in% ww.edger$gene
ww.deseq <- ww.deseq %>%
filter(edger == T)
# keep only drought deseq genes which are not DE in well-watered too
drought.deseq$ww <- drought.deseq$gene %in% ww.deseq$gene
drought.deseq <- drought.deseq %>%
filter(ww == F)
## pull in drought t2 vs t1 all genes
all.genes <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Drought_T2_vs_QUDO_Drought_T1.DESeq2.DE_results")
## GO enrichment file
enrich <- read_delim("../Data/salmon.isoform.counts.matrix.QUDO_Drought_T2_vs_QUDO_Drought_T1.DESeq2.DE_results.P0.01_C2.DE.subset.GOseq.enriched")
# DEGs from mead and gugger
mead.de <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Files/Mead-DE_genes_significant_all_tests.csv")
gugger.de <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/Gugger-TableS2.csv")
# raw expression data from well-watered treatment
ww.genes <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Data/salmon.isoform.counts.matrix.QUDO_Control_T2_vs_QUDO_Control_T1.DESeq2.DE_results")
# Q. douglasii gene annotations
annots <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Files/Qdoug_transcriptome_annotations.tsv")
# Q. lobata protein family annotations
qlob.pfam <- read_delim(col_names = F, "/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Genomics/ReferenceGenome/Qlobata.v3.0.PCG.InterProScan5.34-73.0.tsv")
## read in raw expression data files for two Q. lobata sites
qlob.macr <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Data/Qlob.MACR/salmon.isoform.counts.matrix.control1_vs_drought1.DESeq2.DE_results.P0.01_C2.DE.subset")
qlob.cent <- read_delim("/Users/lilypeck/Library/CloudStorage/Box-Box/SorkLab/Writing/Steele_etal/github/Data/Qlob.CENT/salmon.isoform.counts.matrix.control1_vs_drought1.DESeq2.DE_results.P0.01_C2.DE.subset")
